function g(e){return e.pathname.startsWith("/scope:")}function T(e){return g(e)?e.pathname.split("/")[1].split(":")[1]:null}function ce(e,t){let r=new URL(e);if(g(r))if(t){const n=r.pathname.split("/");n[1]=`scope:${t}`,r.pathname=n.join("/")}else r=M(r);else if(t){const n=r.pathname==="/"?"":r.pathname;r.pathname=`/scope:${t}${n}`}return r}function M(e){if(!g(e))return e;const t=new URL(e),r=t.pathname.split("/");return t.pathname="/"+r.slice(2).join("/"),t}const z=function(){return typeof process<"u"&&process.release?.name==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"}();if(z==="NODE"){let e=function(r){return new Promise(function(n,o){r.onload=r.onerror=function(s){r.onload=r.onerror=null,s.type==="load"?n(r.result):o(new Error("Failed to read the blob/file"))}})},t=function(){const r=new Uint8Array([1,2,3,4]),o=new File([r],"test").stream();try{return o.getReader({mode:"byob"}),!0}catch{return!1}};if(typeof File>"u"){class r extends Blob{constructor(o,s,u){super(o);let i;u?.lastModified&&(i=new Date),(!i||isNaN(i.getFullYear()))&&(i=new Date),this.lastModifiedDate=i,this.lastModified=i.getMilliseconds(),this.name=s||""}}global.File=r}typeof Blob.prototype.arrayBuffer>"u"&&(Blob.prototype.arrayBuffer=function(){const n=new FileReader;return n.readAsArrayBuffer(this),e(n)}),typeof Blob.prototype.text>"u"&&(Blob.prototype.text=function(){const n=new FileReader;return n.readAsText(this),e(n)}),(typeof Blob.prototype.stream>"u"||!t())&&(Blob.prototype.stream=function(){let r=0;const n=this;return new ReadableStream({type:"bytes",autoAllocateChunkSize:512*1024,async pull(o){const s=o.byobRequest.view,i=await n.slice(r,r+s.byteLength).arrayBuffer(),c=new Uint8Array(i);new Uint8Array(s.buffer).set(c);const a=c.byteLength;o.byobRequest.respond(a),r+=a,r>=n.size&&o.close()}})})}if(z==="NODE"&&typeof CustomEvent>"u"){class e extends Event{constructor(r,n={}){super(r,n),this.detail=n.detail}initCustomEvent(){}}globalThis.CustomEvent=e}const le="playground-log",ue=(e,...t)=>{me.dispatchEvent(new CustomEvent(le,{detail:{log:e,args:t}}))},fe=(e,...t)=>{switch(typeof e.message=="string"?Reflect.set(e,"message",P(e.message)):e.message.message&&typeof e.message.message=="string"&&Reflect.set(e.message,"message",P(e.message.message)),e.severity){case h.Debug:console.debug(e.message,...t);break;case h.Info:console.info(e.message,...t);break;case h.Warn:console.warn(e.message,...t);break;case h.Error:console.error(e.message,...t);break;case h.Fatal:console.error(e.message,...t);break;default:console.log(e.message,...t)}},de=e=>e instanceof Error?[e.message,e.stack].join(`
`):JSON.stringify(e,null,2),$=[],_=e=>{$.push(e)},j=e=>{if(e.raw===!0)_(e.message);else{const t=ye(typeof e.message=="object"?de(e.message):e.message,e.severity,e.prefix??w.JS);_(t)}},h={Fatal:{},Error:{name:"error",level:1},Warn:{name:"warn",level:2},Log:{name:"log",level:3},Info:{name:"info",level:4},Debug:{name:"debug",level:5}},w={JS:"JavaScript"};class he extends EventTarget{constructor(t=[]){super(),this.fatalErrorEvent="playground-fatal-error",this.severity=h.Info,this.handlers=t}getLogs(){return this.handlers.includes(j)?[...$]:(this.error(`Logs aren't stored because the logToMemory handler isn't registered.
				If you're using a custom logger instance, make sure to register logToMemory handler.
			`),[])}logMessage(t,...r){const n={...t,severity:t.severity??h.Log};for(const o of this.handlers)n.severity.level<=this.severity.level&&o(n,...r)}setSeverityFilterLevel(t){this.severity=t}log(t,...r){this.logMessage({message:t,severity:h.Log,prefix:w.JS,raw:!1},...r)}debug(t,...r){this.logMessage({message:t,severity:h.Debug,prefix:w.JS,raw:!1},...r)}info(t,...r){this.logMessage({message:t,severity:h.Info,prefix:w.JS,raw:!1},...r)}warn(t,...r){this.logMessage({message:t,severity:h.Warn,prefix:w.JS,raw:!1},...r)}error(t,...r){this.logMessage({message:t,severity:h.Error,prefix:w.JS,raw:!1},...r)}}const pe=()=>{try{}catch{}return[j,fe,ue]},me=new he(pe()),P=e=>e.replace(/\t/g,""),ye=(e,t,r)=>{const n=new Date,o=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",timeZone:"UTC"}).format(n).replace(/ /g,"-"),s=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"UTC",timeZoneName:"short"}).format(n),u=o+" "+s;return e=P(e),`[${u}] ${r} ${t.name}: ${e}`},ge=e=>{e.addEventListener("activate",()=>{e.clients.matchAll().then(t=>{const r={numberOfOpenPlaygroundTabs:t.filter(n=>n.frameType==="top-level").length};for(const n of t)n.postMessage(r)})})},J=Symbol("SleepFinished");function we(e){return new Promise(t=>{setTimeout(()=>t(J),e)})}class Ee extends Error{constructor(){super("Acquiring lock timed out")}}class be{constructor({concurrency:t,timeout:r}){this._running=0,this.concurrency=t,this.timeout=r,this.queue=[]}get remaining(){return this.concurrency-this.running}get running(){return this._running}async acquire(){for(;;)if(this._running>=this.concurrency){const t=new Promise(r=>{this.queue.push(r)});this.timeout!==void 0?await Promise.race([t,we(this.timeout)]).then(r=>{if(r===J)throw new Ee}):await t}else{this._running++;let t=!1;return()=>{t||(t=!0,this._running--,this.queue.length>0&&this.queue.shift()())}}}async run(t){const r=await this.acquire();try{return await t()}finally{r()}}}(function(){return typeof process<"u"&&process.release?.name==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"})();ReadableStream.prototype[Symbol.asyncIterator]||(ReadableStream.prototype[Symbol.asyncIterator]=async function*(){const e=this.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}},ReadableStream.prototype.iterate=ReadableStream.prototype[Symbol.asyncIterator]);new be({concurrency:10});function Re(e,t){for(const r of t)if(new RegExp(r.match).test(e)){e=e.replace(r.match,r.replacement);break}return e}/**
 * Original, unmodified Comlink library from Google:
 *
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const G=Symbol("Comlink.proxy"),Se=Symbol("Comlink.endpoint"),Te=Symbol("Comlink.releaseProxy"),U=Symbol("Comlink.finalizer"),S=Symbol("Comlink.thrown");/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const x={RAW:"RAW",HANDLER:"HANDLER"},d={GET:"GET",SET:"SET",APPLY:"APPLY",CONSTRUCT:"CONSTRUCT",ENDPOINT:"ENDPOINT",RELEASE:"RELEASE"},V=e=>typeof e=="object"&&e!==null||typeof e=="function",xe={canHandle:e=>V(e)&&e[G],serialize(e){const{port1:t,port2:r}=new MessageChannel;return Y(e,t),[r,[r]]},deserialize(e){return e.start(),Le(e)}},Ae={canHandle:e=>V(e)&&S in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},L=new Map([["proxy",xe],["throw",Ae]]);function Ce(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function Y(e,t=globalThis,r=["*"],n){t.addEventListener("message",function o(s){if(!s||!s.data)return;if(!Ce(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:u,type:i,path:c}={path:[],...s.data},a=(s.data.argumentList||[]).map(y);let l;try{const f=c.slice(0,-1).reduce((p,b)=>p[b],e),m=c.reduce((p,b)=>p[b],e);switch(i){case d.GET:l=m;break;case d.SET:f[c.slice(-1)[0]]=y(s.data.value),l=!0;break;case d.APPLY:l=m.apply(f,a);break;case d.CONSTRUCT:{const p=new m(...a);l=Ne(p)}break;case d.ENDPOINT:{const{port1:p,port2:b}=new MessageChannel;Y(e,b),l=Pe(p,[p])}break;case d.RELEASE:l=void 0;break;default:return}}catch(f){l={value:f,[S]:0}}Promise.resolve(l).catch(f=>({value:f,[S]:0})).then(f=>{const[m,p]=k(f);t.postMessage({...m,id:u},p),i===d.RELEASE&&(t.removeEventListener("message",o),Z(t),U in e&&typeof e[U]=="function"&&e[U]())}).catch(()=>{const[f,m]=k({value:new TypeError("Unserializable return value"),[S]:0});t.postMessage({...f,id:u},m)}).finally(()=>{})}),t.start&&t.start()}function ke(e){return e.constructor.name==="MessagePort"}function Z(e){ke(e)&&e.close()}function Le(e,t){const r=new Map;return e.addEventListener("message",function(o){const{data:s}=o;if(!s||!s.id)return;const u=r.get(s.id);if(u)try{u(s)}finally{r.delete(s.id)}}),N(e,r,[],t)}function R(e){if(e)throw new Error("Proxy has been released and is not useable")}function K(e){return E(e,new Map,{type:d.RELEASE}).then(()=>{Z(e)})}const A=new WeakMap,C="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(A.get(e)||0)-1;A.set(e,t),t===0&&K(e)});function Ue(e,t){const r=(A.get(t)||0)+1;A.set(t,r),C&&C.register(e,t,e)}function We(e){C&&C.unregister(e)}function N(e,t,r=[],n=function(){}){let o=!1;const s=new Proxy(n,{get(u,i){if(R(o),i===Te)return()=>{We(s),K(e),t.clear(),o=!0};if(i==="then"){if(r.length===0)return{then:()=>s};const c=E(e,t,{type:d.GET,path:r.map(a=>a.toString())}).then(y);return c.then.bind(c)}return N(e,t,[...r,i])},set(u,i,c){R(o);const[a,l]=k(c);return E(e,t,{type:d.SET,path:[...r,i].map(f=>f.toString()),value:a},l).then(y)},apply(u,i,c){R(o);const a=r[r.length-1];if(a===Se)return E(e,t,{type:d.ENDPOINT}).then(y);if(a==="bind")return N(e,t,r.slice(0,-1));const[l,f]=F(c);return E(e,t,{type:d.APPLY,path:r.map(m=>m.toString()),argumentList:l},f).then(y)},construct(u,i){R(o);const[c,a]=F(i);return E(e,t,{type:d.CONSTRUCT,path:r.map(l=>l.toString()),argumentList:c},a).then(y)}});return Ue(s,e),s}function Me(e){return Array.prototype.concat.apply([],e)}function F(e){const t=e.map(k);return[t.map(r=>r[0]),Me(t.map(r=>r[1]))]}const X=new WeakMap;function Pe(e,t){return X.set(e,t),e}function Ne(e){return Object.assign(e,{[G]:!0})}function k(e){for(const[t,r]of L)if(r.canHandle(e)){const[n,o]=r.serialize(e);return[{type:x.HANDLER,name:t,value:n},o]}return[{type:x.RAW,value:e},X.get(e)||[]]}function y(e){switch(e.type){case x.HANDLER:return L.get(e.name).deserialize(e.value);case x.RAW:return e.value}}function E(e,t,r,n){return new Promise(o=>{const s=Ie();t.set(s,o),e.start&&e.start(),e.postMessage({id:s,...r},n)})}function Ie(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const Oe=[Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),ve=new Map(Oe);class O extends Error{constructor(t){super(O._prepareSuperMessage(t)),this.name="NonError"}static _prepareSuperMessage(t){try{return JSON.stringify(t)}catch{return String(t)}}}const De=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1},{property:"errors",enumerable:!1}],I=new WeakSet,_e=e=>{I.add(e);const t=e.toJSON();return I.delete(e),t},Q=e=>{const t=ve.get(e)??Error;return t===AggregateError?new t([]):new t},v=({from:e,seen:t,to:r,forceEnumerable:n,maxDepth:o,depth:s,useToJSON:u,serialize:i})=>{if(r||(Array.isArray(e)?r=[]:!i&&q(e)?r=Q(e.name):r={}),t.push(e),s>=o)return r;if(u&&typeof e.toJSON=="function"&&!I.has(e))return _e(e);const c=a=>v({from:a,seen:[...t],forceEnumerable:n,maxDepth:o,depth:s,useToJSON:u,serialize:i});for(const[a,l]of Object.entries(e)){if(l&&l instanceof Uint8Array&&l.constructor.name==="Buffer"){r[a]="[object Buffer]";continue}if(l!==null&&typeof l=="object"&&typeof l.pipe=="function"){r[a]="[object Stream]";continue}if(typeof l!="function"){if(!l||typeof l!="object"){try{r[a]=l}catch{}continue}if(!t.includes(e[a])){s++,r[a]=c(e[a]);continue}r[a]="[Circular]"}}if(i||r instanceof Error)for(const{property:a,enumerable:l}of De)e[a]!==void 0&&e[a]!==null&&Object.defineProperty(r,a,{value:q(e[a])||Array.isArray(e[a])?c(e[a]):e[a],enumerable:n?!0:l,configurable:!0,writable:!0});return r};function Fe(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:n=!0}=t;return typeof e=="object"&&e!==null?v({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:n,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function qe(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;return e instanceof Error?e:Be(e)?v({from:e,seen:[],to:Q(e.name),maxDepth:r,depth:0,serialize:!1}):new O(e)}function q(e){return!!e&&typeof e=="object"&&typeof e.name=="string"&&typeof e.message=="string"&&typeof e.stack=="string"}function Be(e){return!!e&&typeof e=="object"&&typeof e.message=="string"&&!Array.isArray(e)}const He=L.get("throw"),ze={canHandle:He.canHandle,serialize:({value:e})=>{let t;return e instanceof Error?(t={isError:!0,value:Fe(e)},t.value.originalErrorClassName=e.constructor.name):t={isError:!1,value:e},[t,[]]},deserialize:e=>{if(e.isError){const t=qe(e.value),r=new Error("Comlink method call failed");let n=t;for(;n.cause;)n=n.cause;throw n.cause=r,t}throw e.value}};L.set("throw",ze);const $e=25e3;let je=0;function Je(){return++je}function ee(e,t,r=$e){return new Promise((n,o)=>{const s=i=>{i.data.type==="response"&&i.data.requestId===t&&(e.removeEventListener("message",s),clearTimeout(u),n(i.data.response))},u=setTimeout(()=>{o(new Error("Request timed out")),e.removeEventListener("message",s)},r);e.addEventListener("message",s)})}async function Ge(e){let t=new URL(e.request.url);if(!g(t))try{const c=new URL(e.request.referrer);t=ce(t,T(c))}catch{}const r=e.request.headers.get("content-type"),n=e.request.method==="POST"?new Uint8Array(await e.request.clone().arrayBuffer()):void 0,o={};for(const c of e.request.headers.entries())o[c[0]]=c[1];let s;try{const c={method:"request",args:[{body:n,url:t.toString(),method:e.request.method,headers:{...o,Host:t.host,"User-agent":self.navigator.userAgent,"Content-type":r}}]},a=T(t);if(a===null)throw new Error(`The URL ${t.toString()} is not scoped. This should not happen.`);const l=await te(c,a);s=await ee(self,l),delete s.headers["x-frame-options"]}catch(c){throw console.error(c,{url:t.toString()}),c}if(s.httpStatusCode>=300&&s.httpStatusCode<=399&&s.headers.location)return Response.redirect(new URL(s.headers.location[0],t.toString()),s.httpStatusCode);const i=[101,103,204,205,304].includes(s.httpStatusCode)?null:s.bytes;return new Response(i,{headers:s.headers,status:s.httpStatusCode})}async function te(e,t){const r=Je();for(const n of await self.clients.matchAll({includeUncontrolled:!0}))n.postMessage({...e,scope:t,requestId:r});return r}async function re(e,t){let r;return["GET","HEAD"].includes(e.method)||"body"in t?r=void 0:!e.bodyUsed&&e.body?r=e.body:r=await e.blob(),new Request(t.url||e.url,{body:r,method:e.method,headers:e.headers,referrer:e.referrer,referrerPolicy:e.referrerPolicy,mode:e.mode==="navigate"?"same-origin":e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,integrity:e.integrity,...r&&{duplex:"half"},...t})}const Ve=[{match:new RegExp("^(/[_0-9a-zA-Z-]+)?(/wp-(content|admin|includes)/.*)"),replacement:"$2"}],Ye="2b0c4dff6f8584eef33d6f187f0a4da9cc7b0b00",ne="playground-cache",se=`${ne}-${Ye}`,D=caches.open(se);async function Ze(e){const t=await D,r=await t.match(e,{ignoreSearch:!0});if(r)return r;const n=await ae(e);return n.ok&&ie()&&t.put(e,n.clone()),n}async function B(e){const t=await D,r=await t.match(e,{ignoreSearch:!0});let n;try{n=await fetch(e,{cache:"no-cache"})}catch(o){if(r)return r;throw o}return n.ok?(t.put(e,n.clone()),n):r||n}async function Ke(){const n=["/",...await(await ae("/assets-required-for-offline-mode.json")).json()].map(s=>new Request(s,{cache:"no-cache"}));await(await D).addAll(n)}async function Xe(){const t=(await caches.keys()).filter(r=>r.startsWith(ne)&&r!==se);return Promise.all(t.map(r=>caches.delete(r)))}function oe(e){return e.href.includes("wordpress-static.zip")?!0:e.href.startsWith("http://127.0.0.1:5400/")||e.href.startsWith("http://localhost:5400/")||e.href.startsWith("https://playground.test/")||e.pathname.startsWith("/website-server/")||g(e)||e.pathname.endsWith(".php")?!1:self.location.hostname===e.hostname}function ae(e,t){return fetch(e,{...t,cache:"no-cache"})}function ie(){return!("serviceWorker"in self)||!("state"in self.serviceWorker)?!0:self.serviceWorker.state==="activated"}self.document||(self.document={});self.addEventListener("install",e=>{e.waitUntil(self.skipWaiting())});self.addEventListener("activate",function(e){async function t(){await self.clients.claim(),oe(new URL(location.href))&&(await Xe(),Ke())}e.waitUntil(t())});self.addEventListener("fetch",e=>{if(!ie())return;const t=new URL(e.request.url);if(t.pathname.startsWith(self.location.pathname)||t.pathname.startsWith("/plugin-proxy")||t.pathname.startsWith("/client/index.js"))return;if(g(t))return e.respondWith(H(e,T(t)));let n;try{n=new URL(e.request.referrer)}catch{}if(n&&g(n))return e.respondWith(H(e,T(n)));if(t.pathname.startsWith("/proxy/")){const s=t.pathname.split("/")[2];switch(s){case"network-first-fetch":{const u=t.pathname.substring(7+s.length+1)+(t?.search?"?"+t.search:"")+(t?.hash?"#"+t.hash:""),i=re(e.request,{url:u});return e.respondWith(i.then(B))}}}if(oe(new URL(e.request.url))){if(t.pathname==="/remote.html"||t.pathname==="/"){e.respondWith(B(e.request));return}return e.respondWith(Ze(e.request))}});async function H(e,t){const r=new URL(e.request.url),n=M(r);if(r.pathname.endsWith("/wp-includes/empty.html"))return et();const o=await Ge(e);if(o.status===404&&o.headers.get("x-backfill-from")==="remote-host"){const{staticAssetsDirectory:s}=await tt(t);if(!s){const a=o.clone();return a.headers.delete("x-backfill-from"),a}const u=new URL(e.request.url),i=M(u);i.pathname=Re(i.pathname,Ve),!i.pathname.startsWith("/@fs")&&!i.pathname.startsWith("/assets")&&(i.pathname=`/${s}${i.pathname}`);const c=await re(e.request,{url:i,credentials:"omit"});return fetch(c).catch(a=>{if(a?.name==="TypeError")return new Promise(l=>{setTimeout(()=>l(fetch(c)),Math.random()*1500)});throw a})}if(n.pathname.endsWith("/block-editor.js")||n.pathname.endsWith("/block-editor.min.js")||n.pathname.endsWith("/block-editor/index.js")||n.pathname.endsWith("/block-editor/index.min.js")){const s=await o.text(),u=`${Qe} ${s.replace(/\(\s*"iframe",/,"(__playground_ControlledIframe,")}`;return new Response(u,{status:o.status,statusText:o.statusText,headers:o.headers})}return o}ge(self);const Qe=`
window.__playground_ControlledIframe = window.wp.element.forwardRef(function (props, ref) {
	const source = window.wp.element.useMemo(function () {
		/**
		 * A synchronous function to read a blob URL as text.
		 *
		 * @param {string} url
		 * @returns {string}
		 */
		const __playground_readBlobAsText = function (url) {
			try {
				let xhr = new XMLHttpRequest();
				xhr.open('GET', url, false);
				xhr.overrideMimeType('text/plain;charset=utf-8');
				xhr.send();
				return xhr.responseText;
			} catch(e) {
				return '';
			} finally {
				URL.revokeObjectURL(url);
			}
		};
		if (props.srcDoc) {
			// WordPress <= 6.2 uses a srcDoc that only contains a doctype.
			return '/wp-includes/empty.html';
		} else if (props.src && props.src.startsWith('blob:')) {
			// WordPress 6.3 uses a blob URL with doctype and a list of static assets.
			// Let's pass the document content to empty.html and render it there.
			return '/wp-includes/empty.html#' + encodeURIComponent(__playground_readBlobAsText(props.src));
		} else {
			// WordPress >= 6.4 uses a plain HTTPS URL that needs no correction.
			return props.src;
		}
	}, [props.src]);
	return (
		window.wp.element.createElement('iframe', {
			...props,
			ref: ref,
			src: source,
			// Make sure there's no srcDoc, as it would interfere with the src.
			srcDoc: undefined
		})
	)
});`;function et(){return new Response("<!doctype html><script>const hash = window.location.hash.substring(1); if ( hash ) document.write(decodeURIComponent(hash))<\/script>",{status:200,headers:{"content-type":"text/html"}})}const W={};async function tt(e){if(!W[e]){const t=await te({method:"getWordPressModuleDetails"},e);W[e]=await ee(self,t)}return W[e]}
//# sourceMappingURL=sw.js.map

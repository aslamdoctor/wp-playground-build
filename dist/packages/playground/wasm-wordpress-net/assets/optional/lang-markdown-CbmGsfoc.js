import{X as K,W as V,H as A,E as x,Y as w,Z as _,G as M,_ as j,o as z,$ as J,J as F,I as Q,a0 as U,a1 as Y,a as Z,a2 as N,a3 as W}from"./vendor-codemirror-CjDT2NJG.js";import{M as ee,e as te,f as ne,g as re,G as oe,S as ie,h as le,E as se}from"./vendor-lezer-BVuE63-5.js";import{html as ae,htmlCompletionSource as fe}from"./lang-html-B08Fw0dr.js";import"./lang-css-DVB8fG3-.js";import"./lang-javascript-rj9Dnv5V.js";const $=V({commentTokens:{block:{open:"<!--",close:"-->"}}}),q=new re,H=ne.configure({props:[F.add(e=>!e.is("Block")||e.is("Document")||y(e)!=null||me(e)?void 0:(i,r)=>({from:r.doc.lineAt(i.from).to,to:i.to})),q.add(y),Q.add({Document:()=>null}),U.add({Document:$})]});function y(e){let i=/^(?:ATX|Setext)Heading(\d)$/.exec(e.name);return i?+i[1]:void 0}function me(e){return e.name=="OrderedList"||e.name=="BulletList"}function ue(e,i){let r=e;for(;;){let t=r.nextSibling,n;if(!t||(n=y(t.type))!=null&&n<=i)break;r=t}return r.to}const ce=_.of((e,i,r)=>{for(let t=A(e).resolveInner(r,-1);t&&!(t.from<i);t=t.parent){let n=t.type.prop(q);if(n==null)continue;let l=ue(t,n);if(l>r)return{from:r,to:l}}return null});function T(e){return new K($,e,[],"markdown")}const de=T(H),pe=H.configure([oe,ie,le,se,{props:[F.add({Table:(e,i)=>({from:i.doc.lineAt(e.from).to,to:e.to})})]}]),P=T(pe);function he(e,i){return r=>{if(r&&e){let t=null;if(r=/\S*/.exec(r)[0],typeof e=="function"?t=e(r):t=N.matchLanguageName(e,r,!0),t instanceof N)return t.support?t.support.language.parser:W.getSkippingParser(t.load());if(t)return t.parser}return i?i.parser:null}}class S{constructor(i,r,t,n,l,a,m){this.node=i,this.from=r,this.to=t,this.spaceBefore=n,this.spaceAfter=l,this.type=a,this.item=m}blank(i,r=!0){let t=this.spaceBefore+(this.node.name=="Blockquote"?">":"");if(i!=null){for(;t.length<i;)t+=" ";return t}else{for(let n=this.to-this.from-t.length-this.spaceAfter.length;n>0;n--)t+=" ";return t+(r?this.spaceAfter:"")}}marker(i,r){let t=this.node.name=="OrderedList"?String(+G(this.item,i)[2]+r):"";return this.spaceBefore+t+this.type+this.spaceAfter}}function X(e,i){let r=[],t=[];for(let n=e;n;n=n.parent){if(n.name=="FencedCode")return t;(n.name=="ListItem"||n.name=="Blockquote")&&r.push(n)}for(let n=r.length-1;n>=0;n--){let l=r[n],a,m=i.lineAt(l.from),o=l.from-m.from;if(l.name=="Blockquote"&&(a=/^ *>( ?)/.exec(m.text.slice(o))))t.push(new S(l,o,o+a[0].length,"",a[1],">",null));else if(l.name=="ListItem"&&l.parent.name=="OrderedList"&&(a=/^( *)\d+([.)])( *)/.exec(m.text.slice(o)))){let f=a[3],s=a[0].length;f.length>=4&&(f=f.slice(0,f.length-4),s-=4),t.push(new S(l.parent,o,o+s,a[1],f,a[2],l))}else if(l.name=="ListItem"&&l.parent.name=="BulletList"&&(a=/^( *)([-+*])( {1,4}\[[ xX]\])?( +)/.exec(m.text.slice(o)))){let f=a[4],s=a[0].length;f.length>4&&(f=f.slice(0,f.length-4),s-=4);let c=a[2];a[3]&&(c+=a[3].replace(/[xX]/," ")),t.push(new S(l.parent,o,o+s,a[1],f,c,l))}}return t}function G(e,i){return/^(\s*)(\d+)(?=[.)])/.exec(i.sliceString(e.from,e.from+10))}function I(e,i,r,t=0){for(let n=-1,l=e;;){if(l.name=="ListItem"){let m=G(l,i),o=+m[2];if(n>=0){if(o!=n+1)return;r.push({from:l.from+m[1].length,to:l.from+m[0].length,insert:String(n+2+t)})}n=o}let a=l.nextSibling;if(!a)break;l=a}}function E(e,i){let r=/^[ \t]*/.exec(e)[0].length;if(!r||i.facet(J)!="	")return e;let t=w(e,4,r),n="";for(let l=t;l>0;)l>=4?(n+="	",l-=4):(n+=" ",l--);return n+e.slice(r)}const ge=({state:e,dispatch:i})=>{let r=A(e),{doc:t}=e,n=null,l=e.changeByRange(a=>{if(!a.empty||!P.isActiveAt(e,a.from,-1)&&!P.isActiveAt(e,a.from,1))return n={range:a};let m=a.from,o=t.lineAt(m),f=X(r.resolveInner(m,-1),t);for(;f.length&&f[f.length-1].from>m-o.from;)f.pop();if(!f.length)return n={range:a};let s=f[f.length-1];if(s.to-s.spaceAfter.length>m-o.from)return n={range:a};let c=m>=s.to-s.spaceAfter.length&&!/\S/.test(o.text.slice(s.to));if(s.item&&c){let d=s.node.firstChild,h=s.node.getChild("ListItem","ListItem");if(d.to>=m||h&&h.to<m||o.from>0&&!/[^\s>]/.test(t.lineAt(o.from-1).text)){let u=f.length>1?f[f.length-2]:null,b,C="";u&&u.item?(b=o.from+u.from,C=u.marker(t,1)):b=o.from+(u?u.to:0);let B=[{from:b,to:m,insert:C}];return s.node.name=="OrderedList"&&I(s.item,t,B,-2),u&&u.node.name=="OrderedList"&&I(u.item,t,B),{range:x.cursor(b+C.length),changes:B}}else{let u=D(f,e,o);return{range:x.cursor(m+u.length+1),changes:{from:o.from,insert:u+e.lineBreak}}}}if(s.node.name=="Blockquote"&&c&&o.from){let d=t.lineAt(o.from-1),h=/>\s*$/.exec(d.text);if(h&&h.index==s.from){let u=e.changes([{from:d.from+h.index,to:d.to},{from:o.from+s.from,to:o.to}]);return{range:a.map(u),changes:u}}}let p=[];s.node.name=="OrderedList"&&I(s.item,t,p);let k=s.item&&s.item.from<o.from,g="";if(!k||/^[\s\d.)\-+*>]*/.exec(o.text)[0].length>=s.to)for(let d=0,h=f.length-1;d<=h;d++)g+=d==h&&!k?f[d].marker(t,1):f[d].blank(d<h?w(o.text,4,f[d+1].from)-g.length:null);let L=m;for(;L>o.from&&/\s/.test(o.text.charAt(L-o.from-1));)L--;return g=E(g,e),ke(s.node,e.doc)&&(g=D(f,e,o)+e.lineBreak+g),p.push({from:L,to:m,insert:e.lineBreak+g}),{range:x.cursor(L+g.length+1),changes:p}});return n?!1:(i(e.update(l,{scrollIntoView:!0,userEvent:"input"})),!0)};function O(e){return e.name=="QuoteMark"||e.name=="ListMark"}function ke(e,i){if(e.name!="OrderedList"&&e.name!="BulletList")return!1;let r=e.firstChild,t=e.getChild("ListItem","ListItem");if(!t)return!1;let n=i.lineAt(r.to),l=i.lineAt(t.from),a=/^[\s>]*$/.test(n.text);return n.number+(a?0:1)<l.number}function D(e,i,r){let t="";for(let n=0,l=e.length-2;n<=l;n++)t+=e[n].blank(n<l?w(r.text,4,e[n+1].from)-t.length:null,n<l);return E(t,i)}function xe(e,i){let r=e.resolveInner(i,-1),t=i;O(r)&&(t=r.from,r=r.parent);for(let n;n=r.childBefore(t);)if(O(n))t=n.from;else if(n.name=="OrderedList"||n.name=="BulletList")r=n.lastChild,t=r.to;else break;return r}const Le=({state:e,dispatch:i})=>{let r=A(e),t=null,n=e.changeByRange(l=>{let a=l.from,{doc:m}=e;if(l.empty&&P.isActiveAt(e,l.from)){let o=m.lineAt(a),f=X(xe(r,a),m);if(f.length){let s=f[f.length-1],c=s.to-s.spaceAfter.length+(s.spaceAfter?1:0);if(a-o.from>c&&!/\S/.test(o.text.slice(c,a-o.from)))return{range:x.cursor(o.from+c),changes:{from:o.from+c,to:a}};if(a-o.from==c&&(!s.item||o.from<=s.item.from||!/\S/.test(o.text.slice(0,s.to)))){let p=o.from+s.from;if(s.item&&s.node.from<s.item.from&&/\S/.test(o.text.slice(s.from,s.to))){let k=s.blank(w(o.text,4,s.to)-w(o.text,4,s.from));return p==o.from&&(k=E(k,e)),{range:x.cursor(p+k.length),changes:{from:p,to:o.from+s.to,insert:k}}}if(p<a)return{range:x.cursor(p),changes:{from:p,to:a}}}}}return t={range:l}});return t?!1:(i(e.update(n,{scrollIntoView:!0,userEvent:"delete"})),!0)},we=[{key:"Enter",run:ge},{key:"Backspace",run:Le}],R=ae({matchClosingTags:!1});function ye(e={}){let{codeLanguages:i,defaultCodeLanguage:r,addKeymap:t=!0,base:{parser:n}=de,completeHTMLTags:l=!0,htmlTagLanguage:a=R}=e;if(!(n instanceof ee))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let m=e.extensions?[e.extensions]:[],o=[a.support,ce],f;r instanceof M?(o.push(r.support),f=r.language):r&&(f=r);let s=i||f?he(i,f):void 0;m.push(te({codeParser:s,htmlParser:a.language.parser})),t&&o.push(j.high(z.of(we)));let c=T(n.configure(m));return l&&o.push(c.data.of({autocomplete:be})),new M(c,o)}function be(e){let{state:i,pos:r}=e,t=/<[:\-\.\w\u00b7-\uffff]*$/.exec(i.sliceDoc(r-25,r));if(!t)return null;let n=A(i).resolveInner(r,-1);for(;n&&!n.type.isTop;){if(n.name=="CodeBlock"||n.name=="FencedCode"||n.name=="ProcessingInstructionBlock"||n.name=="CommentBlock"||n.name=="Link"||n.name=="Image")return null;n=n.parent}return{from:r-t[0].length,to:r,options:Ae(),validFor:/^<[:\-\.\w\u00b7-\uffff]*$/}}let v=null;function Ae(){if(v)return v;let e=fe(new Y(Z.create({extensions:R}),0,!0));return v=e?e.options:[]}export{de as commonmarkLanguage,Le as deleteMarkupBackward,ge as insertNewlineContinueMarkup,ye as markdown,we as markdownKeymap,P as markdownLanguage};
//# sourceMappingURL=lang-markdown-CbmGsfoc.js.map

{"version":3,"file":"index-BjX23IKV.js","sources":["../../../../../packages/playground/website/src/components/site-manager/site-file-browser/file-explorer-sidebar.tsx","../../../../../packages/playground/website/src/components/site-manager/site-file-browser/index.tsx"],"sourcesContent":["import {\n\tuseMemo,\n\tuseRef,\n\tuseState,\n\ttype Dispatch,\n\ttype SetStateAction,\n} from 'react';\nimport { Icon } from '@wordpress/components';\nimport { file as folderIcon, page as fileIcon } from '@wordpress/icons';\nimport styles from './file-explorer.module.css';\nimport {\n\tFilePickerTree,\n\ttype FilePickerTreeHandle,\n} from '@wp-playground/components';\nimport type { AsyncWritableFilesystem } from '@wp-playground/storage';\nimport { logger } from '@php-wasm/logger';\nimport { dirname, normalizePath } from '@php-wasm/util';\nimport { BinaryFilePreview } from '@wp-playground/components';\nimport mimeTypes from '@php-wasm/universal/mime-types';\n\nexport const MAX_INLINE_FILE_BYTES = 1024 * 1024; // 1MB\n\nconst seemsLikeBinary = (buffer: Uint8Array) => {\n\t// Assume that anything with a null byte in the first 4096 bytes is binary.\n\t// This isn't a perfect test, but it catches a lot of binary files.\n\tconst len = buffer.byteLength;\n\tfor (let i = 0; i < Math.min(len, 4096); i++) {\n\t\tif (buffer[i] === 0) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t// Next, try to decode the buffer as UTF-8. If it fails, it's probably binary.\n\ttry {\n\t\tnew TextDecoder('utf-8', { fatal: true }).decode(buffer);\n\t\treturn false;\n\t} catch {\n\t\treturn true;\n\t}\n};\n\nconst createDownloadUrl = (data: Uint8Array, filename: string) => {\n\tconst blob = new Blob([data]);\n\tconst url = URL.createObjectURL(blob);\n\tsetTimeout(() => URL.revokeObjectURL(url), 60_000);\n\treturn { url, filename };\n};\n\nconst getMimeType = (filename: string): string => {\n\tconst extension = filename.split('.').pop() as keyof typeof mimeTypes;\n\treturn mimeTypes[extension] || mimeTypes['_default'];\n};\n\nconst isPreviewableBinary = (mimeType: string): boolean => {\n\treturn (\n\t\tmimeType.startsWith('image/') ||\n\t\tmimeType.startsWith('video/') ||\n\t\tmimeType.startsWith('audio/')\n\t);\n};\n\nexport type FileExplorerSidebarProps = {\n\tfilesystem: AsyncWritableFilesystem;\n\tcurrentPath: string | null;\n\tselectedDirPath: string | null;\n\tsetSelectedDirPath: Dispatch<SetStateAction<string | null>>;\n\tonFileOpened: (\n\t\tpath: string,\n\t\tcontent: string,\n\t\tshouldFocus?: boolean\n\t) => Promise<void> | void;\n\tonSelectionCleared: () => Promise<void> | void;\n\tonShowMessage: (\n\t\tpath: string | null,\n\t\tmessage: string | JSX.Element\n\t) => Promise<void> | void;\n\tdocumentRoot: string;\n};\n\nexport function FileExplorerSidebar({\n\tfilesystem,\n\tcurrentPath,\n\tselectedDirPath,\n\tsetSelectedDirPath,\n\tonFileOpened,\n\tonSelectionCleared,\n\tonShowMessage,\n\tdocumentRoot,\n}: FileExplorerSidebarProps) {\n\tconst treeRef = useRef<FilePickerTreeHandle | null>(null);\n\n\tconst treeInitialPath = useMemo(() => {\n\t\treturn normalizePath(\n\t\t\tcurrentPath\n\t\t\t\t? dirname(normalizePath(currentPath))\n\t\t\t\t: (selectedDirPath ?? documentRoot)\n\t\t);\n\t\t// Prevent tree from jumping unexpectedly when selectedDirPath changes.\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [currentPath, documentRoot]);\n\n\tconst [lastSelectedPath, setLastSelectedPath] = useState<string | null>(\n\t\tnull\n\t);\n\n\tconst handleOpenFile = async (path: string, shouldFocus: boolean) => {\n\t\ttry {\n\t\t\tconst file = await filesystem.read(path);\n\t\t\tconst data = new Uint8Array(await file.arrayBuffer());\n\t\t\tconst size = data.byteLength;\n\t\t\tconst filename = path.split('/').pop() || 'download';\n\n\t\t\tif (size > MAX_INLINE_FILE_BYTES) {\n\t\t\t\tconst { url, filename: fname } = createDownloadUrl(\n\t\t\t\t\tdata,\n\t\t\t\t\tfilename\n\t\t\t\t);\n\t\t\t\tawait onShowMessage(\n\t\t\t\t\tpath,\n\t\t\t\t\t<>\n\t\t\t\t\t\t<p>File too large to open (&gt;1MB).</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<a href={url} download={fname}>\n\t\t\t\t\t\t\t\tDownload {fname}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (seemsLikeBinary(data)) {\n\t\t\t\tconst mimeType = getMimeType(filename);\n\t\t\t\tconst { url: downloadUrl, filename: fname } = createDownloadUrl(\n\t\t\t\t\tdata,\n\t\t\t\t\tfilename\n\t\t\t\t);\n\n\t\t\t\t// Check if this is a previewable binary file\n\t\t\t\tif (isPreviewableBinary(mimeType)) {\n\t\t\t\t\t// Create a data URL for the preview\n\t\t\t\t\tconst blob = new Blob([data], { type: mimeType });\n\t\t\t\t\tconst dataUrl = URL.createObjectURL(blob);\n\n\t\t\t\t\tawait onShowMessage(\n\t\t\t\t\t\tpath,\n\t\t\t\t\t\t<BinaryFilePreview\n\t\t\t\t\t\t\tfilename={fname}\n\t\t\t\t\t\t\tmimeType={mimeType}\n\t\t\t\t\t\t\tdataUrl={dataUrl}\n\t\t\t\t\t\t\tdownloadUrl={downloadUrl}\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Non-previewable binary file\n\t\t\t\tawait onShowMessage(\n\t\t\t\t\tpath,\n\t\t\t\t\t<>\n\t\t\t\t\t\t<p>Binary file. Cannot be edited.</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<a href={downloadUrl} download={fname}>\n\t\t\t\t\t\t\t\tDownload {fname}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst text = new TextDecoder('utf-8').decode(data);\n\t\t\tawait onFileOpened(path, text, shouldFocus);\n\t\t} catch (error) {\n\t\t\tlogger.error('Could not open file', error);\n\t\t\tawait onShowMessage(null, 'Could not open file.');\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className={styles.fileExplorerContainer}>\n\t\t\t<div className={styles.fileExplorerHeader}>\n\t\t\t\t<span className={styles.fileExplorerTitle}>Files</span>\n\t\t\t\t<div className={styles.fileExplorerActions}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName={styles.fileExplorerButton}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tif (!treeRef.current) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvoid treeRef.current.createFile(\n\t\t\t\t\t\t\t\tlastSelectedPath ?? undefined\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ttitle=\"Create new file\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon icon={fileIcon} size={16} />\n\t\t\t\t\t\tNew File\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName={styles.fileExplorerButton}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tif (!treeRef.current) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvoid treeRef.current.createFolder(\n\t\t\t\t\t\t\t\tlastSelectedPath ?? undefined\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ttitle=\"Create new folder\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon icon={folderIcon} size={16} />\n\t\t\t\t\t\tNew Folder\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className={styles.fileExplorerTree}>\n\t\t\t\t<FilePickerTree\n\t\t\t\t\tref={treeRef}\n\t\t\t\t\tfilesystem={filesystem}\n\t\t\t\t\troot={documentRoot}\n\t\t\t\t\tinitialSelectedPath={treeInitialPath}\n\t\t\t\t\tonSelect={async (path) => {\n\t\t\t\t\t\tsetLastSelectedPath(path);\n\t\t\t\t\t\tif (!path) {\n\t\t\t\t\t\t\tawait onSelectionCleared();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (await filesystem.isDir(path)) {\n\t\t\t\t\t\t\t\tsetSelectedDirPath(path);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t// If we cannot determine whether it is a directory, treat as file.\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// For files, open them but don't move focus to the editor\n\t\t\t\t\t\tawait handleOpenFile(path, false);\n\t\t\t\t\t}}\n\t\t\t\t\tonDoubleClickFile={async (path) => {\n\t\t\t\t\t\t// On double-click, open the file and move focus to the editor\n\t\t\t\t\t\tawait handleOpenFile(path, true);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import {\n\tuseCallback,\n\tuseEffect,\n\tuseMemo,\n\tuseRef,\n\tuseState,\n\ttype MutableRefObject,\n} from 'react';\nimport classNames from 'classnames';\nimport { Button, Notice } from '@wordpress/components';\nimport type { SiteInfo } from '../../../lib/state/redux/slice-sites';\nimport { usePlaygroundClient } from '../../../lib/use-playground-client';\nimport type { AsyncWritableFilesystem } from '@wp-playground/storage';\nimport type { PlaygroundClient } from '@wp-playground/remote';\nimport { FileExplorerSidebar } from './file-explorer-sidebar';\nimport { CodeEditor, type CodeEditorHandle } from './code-editor';\nimport styles from './style.module.css';\nimport { logger } from '@php-wasm/logger';\n\nconst SAVE_DEBOUNCE_MS = 1500;\n\nconst SaveState = {\n\tIDLE: 'idle',\n\tPENDING: 'pending',\n\tSAVING: 'saving',\n\tSAVED: 'saved',\n\tERROR: 'error',\n} as const;\n\ntype SaveState = (typeof SaveState)[keyof typeof SaveState];\n\nexport function SiteFileBrowser({\n\tsite,\n\tisVisible = true,\n\tdocumentRoot,\n}: {\n\tsite: SiteInfo;\n\tisVisible?: boolean;\n\tdocumentRoot: string;\n}) {\n\tconst client = usePlaygroundClient(site.slug);\n\tconst filesystem = useFilesystem(client);\n\n\tconst [selectedDirPath, setSelectedDirPath] = useState<string | null>(\n\t\t`${documentRoot}/workspace`\n\t);\n\tconst [currentPath, setCurrentPath] = useState<string | null>(null);\n\tconst [code, setCode] = useState<string>('');\n\tconst [readOnly, setReadOnly] = useState<boolean>(true);\n\tconst [saveState, setSaveState] = useState<SaveState>(SaveState.IDLE);\n\tconst [saveError, setSaveError] = useState<string | null>(null);\n\tconst [showExplorerOnMobile, setShowExplorerOnMobile] =\n\t\tuseState<boolean>(false);\n\tconst [treeTypeAheadEnabled, setTreeTypeAheadEnabled] =\n\t\tuseState<boolean>(true);\n\tconst [messageContent, setMessageContent] = useState<\n\t\tstring | JSX.Element | null\n\t>(null);\n\n\tconst editorRef = useRef<CodeEditorHandle | null>(null);\n\tconst saveTimeoutRef = useRef<number | null>(null);\n\tconst skipNextSaveRef = useRef<boolean>(false);\n\tconst codeRef = useRef<string>(code);\n\tconst currentPathRef = useRef<string | null>(currentPath);\n\tconst clientRef = useRef<PlaygroundClient | null>(client);\n\tconst previousClientRef = useRef<PlaygroundClient | null>(client);\n\tconst hasAutoOpenedRef = useRef<boolean>(false);\n\tconst cursorPositionsRef = useRef<Map<string, number>>(new Map());\n\n\tuseEffect(() => {\n\t\tcodeRef.current = code;\n\t}, [code]);\n\n\tuseEffect(() => {\n\t\tcurrentPathRef.current = currentPath;\n\t}, [currentPath]);\n\n\tuseEffect(() => {\n\t\tclientRef.current = client ?? null;\n\t}, [client]);\n\n\tuseEffect(() => {\n\t\tif (previousClientRef.current && previousClientRef.current !== client) {\n\t\t\tvoid flushPendingSave(previousClientRef.current, {\n\t\t\t\tsaveTimeoutRef,\n\t\t\t\tcurrentPathRef,\n\t\t\t\tcodeRef,\n\t\t\t\tsetSaveState,\n\t\t\t\tsetSaveError,\n\t\t\t});\n\t\t}\n\t\tpreviousClientRef.current = client ?? null;\n\t}, [client]);\n\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tvoid flushPendingSave(clientRef.current, {\n\t\t\t\tsaveTimeoutRef,\n\t\t\t\tcurrentPathRef,\n\t\t\t\tcodeRef,\n\t\t\t\tsetSaveState,\n\t\t\t\tsetSaveError,\n\t\t\t});\n\t\t};\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (!client) {\n\t\t\tskipNextSaveRef.current = true;\n\t\t\tsetCode('');\n\t\t\tsetCurrentPath(null);\n\t\t\tsetReadOnly(true);\n\t\t\tsetSaveState(SaveState.IDLE);\n\t\t\tsetSaveError(null);\n\t\t\tsetShowExplorerOnMobile(false);\n\t\t\tsetMessageContent(null);\n\t\t}\n\t}, [client]);\n\n\tuseEffect(() => {\n\t\tsetSelectedDirPath(`${documentRoot}/workspace`);\n\t\tsetCurrentPath(null);\n\t\tsetCode('');\n\t\tsetReadOnly(true);\n\t\tsetSaveState(SaveState.IDLE);\n\t\tsetSaveError(null);\n\t\tskipNextSaveRef.current = true;\n\t\tsetMessageContent(null);\n\t\thasAutoOpenedRef.current = false;\n\t}, [site.slug, documentRoot]);\n\n\tuseEffect(() => {\n\t\tconst activeClient = clientRef.current;\n\t\tif (!activeClient || !currentPath) {\n\t\t\tif (saveTimeoutRef.current !== null) {\n\t\t\t\twindow.clearTimeout(saveTimeoutRef.current);\n\t\t\t\tsaveTimeoutRef.current = null;\n\t\t\t}\n\t\t\tif (!currentPath) {\n\t\t\t\tsetSaveState(SaveState.IDLE);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (skipNextSaveRef.current) {\n\t\t\tskipNextSaveRef.current = false;\n\t\t\treturn;\n\t\t}\n\t\tif (saveTimeoutRef.current !== null) {\n\t\t\twindow.clearTimeout(saveTimeoutRef.current);\n\t\t\tsaveTimeoutRef.current = null;\n\t\t}\n\t\tsetSaveState(SaveState.PENDING);\n\t\tconst timeout = window.setTimeout(async () => {\n\t\t\tsaveTimeoutRef.current = null;\n\t\t\tsetSaveState(SaveState.SAVING);\n\t\t\ttry {\n\t\t\t\tawait activeClient.writeFile(\n\t\t\t\t\tcurrentPathRef.current as string,\n\t\t\t\t\tcodeRef.current\n\t\t\t\t);\n\t\t\t\tsetSaveState(SaveState.SAVED);\n\t\t\t\tsetSaveError(null);\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('Failed to save file', error);\n\t\t\t\tsetSaveState(SaveState.ERROR);\n\t\t\t\tsetSaveError('Could not save changes. Try again.');\n\t\t\t}\n\t\t}, SAVE_DEBOUNCE_MS);\n\t\tsaveTimeoutRef.current = timeout;\n\n\t\treturn () => {\n\t\t\tif (saveTimeoutRef.current === timeout) {\n\t\t\t\twindow.clearTimeout(timeout);\n\t\t\t\tsaveTimeoutRef.current = null;\n\t\t\t}\n\t\t};\n\t}, [code, currentPath]);\n\n\tuseEffect(() => {\n\t\tif (saveState !== SaveState.SAVED) {\n\t\t\treturn;\n\t\t}\n\t\tconst timeout = window.setTimeout(() => {\n\t\t\tsetSaveState((previous) =>\n\t\t\t\tprevious === SaveState.SAVED ? SaveState.IDLE : previous\n\t\t\t);\n\t\t}, 2000);\n\t\treturn () => window.clearTimeout(timeout);\n\t}, [saveState]);\n\n\t// Auto-open wp-config.php if it exists\n\tuseEffect(() => {\n\t\tif (!client || hasAutoOpenedRef.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst wpConfigPath = `${documentRoot}/wp-config.php`;\n\n\t\tconst tryAutoOpen = async () => {\n\t\t\ttry {\n\t\t\t\tconst exists = await client.fileExists(wpConfigPath);\n\t\t\t\tif (exists) {\n\t\t\t\t\tconst content = await client.readFileAsText(wpConfigPath);\n\t\t\t\t\tskipNextSaveRef.current = true;\n\t\t\t\t\tsetCurrentPath(wpConfigPath);\n\t\t\t\t\tsetCode(content);\n\t\t\t\t\tsetReadOnly(false);\n\t\t\t\t\tsetSaveState(SaveState.IDLE);\n\t\t\t\t\tsetSaveError(null);\n\t\t\t\t\t// Focus the editor after opening\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\teditorRef.current?.focus();\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Silently fail - wp-config.php may not exist or may not be readable\n\t\t\t\tlogger.debug('Could not auto-open wp-config.php:', error);\n\t\t\t} finally {\n\t\t\t\thasAutoOpenedRef.current = true;\n\t\t\t}\n\t\t};\n\n\t\tvoid tryAutoOpen();\n\t}, [client, documentRoot]);\n\n\tconst handleFileOpened = useCallback(\n\t\tasync (path: string, content: string, shouldFocus = true) => {\n\t\t\t// Save cursor position of current file before switching\n\t\t\tconst currentPos = editorRef.current?.getCursorPosition();\n\t\t\tif (\n\t\t\t\tcurrentPos !== null &&\n\t\t\t\tcurrentPos !== undefined &&\n\t\t\t\tcurrentPathRef.current\n\t\t\t) {\n\t\t\t\tcursorPositionsRef.current.set(\n\t\t\t\t\tcurrentPathRef.current,\n\t\t\t\t\tcurrentPos\n\t\t\t\t);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait flushPendingSave(clientRef.current, {\n\t\t\t\t\tsaveTimeoutRef,\n\t\t\t\t\tcurrentPathRef,\n\t\t\t\t\tcodeRef,\n\t\t\t\t\tsetSaveState,\n\t\t\t\t\tsetSaveError,\n\t\t\t\t});\n\t\t\t} catch {\n\t\t\t\t// Best-effort save; ignore errors so the new file can still open.\n\t\t\t}\n\t\t\tskipNextSaveRef.current = true;\n\t\t\tsetCurrentPath(path);\n\t\t\tsetCode(content);\n\t\t\tsetMessageContent(null);\n\t\t\tsetReadOnly(false);\n\t\t\tsetSaveState(SaveState.IDLE);\n\t\t\tsetSaveError(null);\n\t\t\tsetShowExplorerOnMobile(false);\n\n\t\t\t// Restore cursor position for this file if we have one saved\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst savedPos = cursorPositionsRef.current.get(path);\n\t\t\t\tif (savedPos !== undefined) {\n\t\t\t\t\teditorRef.current?.setCursorPosition(savedPos);\n\t\t\t\t}\n\t\t\t\tif (shouldFocus) {\n\t\t\t\t\teditorRef.current?.focus();\n\t\t\t\t\tsetTreeTypeAheadEnabled(false);\n\t\t\t\t} else {\n\t\t\t\t\teditorRef.current?.blur();\n\t\t\t\t\tsetTreeTypeAheadEnabled(true);\n\t\t\t\t}\n\t\t\t}, 50);\n\t\t},\n\t\t[]\n\t);\n\n\t// Periodically save cursor position while editing\n\tuseEffect(() => {\n\t\tif (!currentPath) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst interval = setInterval(() => {\n\t\t\tconst pos = editorRef.current?.getCursorPosition();\n\t\t\tif (pos !== null && pos !== undefined) {\n\t\t\t\tcursorPositionsRef.current.set(currentPath, pos);\n\t\t\t}\n\t\t}, 1000);\n\n\t\t// Save immediately on mount and when currentPath changes\n\t\tconst pos = editorRef.current?.getCursorPosition();\n\t\tif (pos !== null && pos !== undefined) {\n\t\t\tcursorPositionsRef.current.set(currentPath, pos);\n\t\t}\n\n\t\treturn () => {\n\t\t\tclearInterval(interval);\n\t\t\t// Save one final time when unmounting or changing files\n\t\t\tconst finalPos = editorRef.current?.getCursorPosition();\n\t\t\tif (finalPos !== null && finalPos !== undefined) {\n\t\t\t\tcursorPositionsRef.current.set(currentPath, finalPos);\n\t\t\t}\n\t\t};\n\t}, [currentPath]);\n\n\t// Restore cursor position when tab becomes visible\n\tuseEffect(() => {\n\t\tif (!isVisible || !currentPath) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Wait a bit for the editor to be ready\n\t\tconst timeout = setTimeout(() => {\n\t\t\tconst savedPos = cursorPositionsRef.current.get(currentPath);\n\t\t\tif (savedPos !== undefined) {\n\t\t\t\teditorRef.current?.setCursorPosition(savedPos);\n\t\t\t}\n\t\t\tif (!treeTypeAheadEnabled) {\n\t\t\t\teditorRef.current?.focus();\n\t\t\t}\n\t\t}, 100);\n\n\t\treturn () => clearTimeout(timeout);\n\t}, [isVisible, currentPath, treeTypeAheadEnabled]);\n\n\tconst handleClearSelection = useCallback(async () => {\n\t\t// Save cursor position before clearing\n\t\tconst currentPos = editorRef.current?.getCursorPosition();\n\t\tif (\n\t\t\tcurrentPos !== null &&\n\t\t\tcurrentPos !== undefined &&\n\t\t\tcurrentPathRef.current\n\t\t) {\n\t\t\tcursorPositionsRef.current.set(currentPathRef.current, currentPos);\n\t\t}\n\n\t\ttry {\n\t\t\tawait flushPendingSave(clientRef.current, {\n\t\t\t\tsaveTimeoutRef,\n\t\t\t\tcurrentPathRef,\n\t\t\t\tcodeRef,\n\t\t\t\tsetSaveState,\n\t\t\t\tsetSaveError,\n\t\t\t});\n\t\t} catch {\n\t\t\t/* noop */\n\t\t}\n\t\tskipNextSaveRef.current = true;\n\t\tsetCurrentPath(null);\n\t\tsetCode('');\n\t\tsetMessageContent(null);\n\t\tsetReadOnly(true);\n\t\tsetSaveState(SaveState.IDLE);\n\t\tsetSaveError(null);\n\t}, []);\n\n\tconst handleShowMessage = useCallback(\n\t\tasync (_path: string | null, message: string | JSX.Element) => {\n\t\t\ttry {\n\t\t\t\tawait flushPendingSave(clientRef.current, {\n\t\t\t\t\tsaveTimeoutRef,\n\t\t\t\t\tcurrentPathRef,\n\t\t\t\t\tcodeRef,\n\t\t\t\t\tsetSaveState,\n\t\t\t\t\tsetSaveError,\n\t\t\t\t});\n\t\t\t} catch {\n\t\t\t\t/* noop */\n\t\t\t}\n\t\t\tskipNextSaveRef.current = true;\n\t\t\tsetCurrentPath(null);\n\n\t\t\t// If it's a string, show it in the code editor\n\t\t\t// If it's JSX, show it in a separate message area\n\t\t\tif (typeof message === 'string') {\n\t\t\t\tsetCode(message);\n\t\t\t\tsetMessageContent(null);\n\t\t\t} else {\n\t\t\t\tsetCode('');\n\t\t\t\tsetMessageContent(message);\n\t\t\t}\n\n\t\t\tsetReadOnly(true);\n\t\t\tsetSaveState(SaveState.IDLE);\n\t\t\tsetSaveError(null);\n\t\t\tsetShowExplorerOnMobile(false);\n\t\t},\n\t\t[]\n\t);\n\n\tconst handleManualSave = useCallback(() => {\n\t\tvoid flushPendingSave(clientRef.current, {\n\t\t\tsaveTimeoutRef,\n\t\t\tcurrentPathRef,\n\t\t\tcodeRef,\n\t\t\tsetSaveState,\n\t\t\tsetSaveError,\n\t\t});\n\t}, []);\n\n\tconst saveStatusLabel = getSaveStatusLabel(saveState, saveError);\n\tconst saveStatusClassName = getSaveStatusClassName(saveState, styles);\n\n\tif (!client || !filesystem) {\n\t\treturn (\n\t\t\t<div className={styles.container}>\n\t\t\t\t<div className={styles.placeholder}>\n\t\t\t\t\tStart this Playground to browse and edit its files.\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className={styles.container}>\n\t\t\t<div\n\t\t\t\tclassName={classNames(styles.content, {\n\t\t\t\t\t[styles.sidebarOpen]: showExplorerOnMobile,\n\t\t\t\t})}\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclassName={styles.mobileOverlay}\n\t\t\t\t\tonClick={() => setShowExplorerOnMobile(false)}\n\t\t\t\t/>\n\t\t\t\t<aside className={styles.sidebarWrapper}>\n\t\t\t\t\t<FileExplorerSidebar\n\t\t\t\t\t\tfilesystem={filesystem}\n\t\t\t\t\t\tcurrentPath={currentPath}\n\t\t\t\t\t\tselectedDirPath={selectedDirPath}\n\t\t\t\t\t\tsetSelectedDirPath={setSelectedDirPath}\n\t\t\t\t\t\tonFileOpened={handleFileOpened}\n\t\t\t\t\t\tonSelectionCleared={handleClearSelection}\n\t\t\t\t\t\tonShowMessage={handleShowMessage}\n\t\t\t\t\t\tdocumentRoot={documentRoot}\n\t\t\t\t\t/>\n\t\t\t\t</aside>\n\t\t\t\t<section className={styles.editorWrapper}>\n\t\t\t\t\t<div className={styles.editorHeader}>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName={styles.mobileToggle}\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\tsetShowExplorerOnMobile((previous) => !previous)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{showExplorerOnMobile\n\t\t\t\t\t\t\t\t? 'Hide files'\n\t\t\t\t\t\t\t\t: 'Browse files'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={classNames(styles.editorPath, {\n\t\t\t\t\t\t\t\t[styles.editorPathPlaceholder]:\n\t\t\t\t\t\t\t\t\t!currentPath?.length,\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{currentPath?.length\n\t\t\t\t\t\t\t\t? currentPath\n\t\t\t\t\t\t\t\t: `Browse files under ${documentRoot}`}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\tstyles.saveStatus,\n\t\t\t\t\t\t\t\tsaveStatusClassName\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{saveStatusLabel}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{saveError ? (\n\t\t\t\t\t\t<div style={{ padding: '8px 16px' }}>\n\t\t\t\t\t\t\t<Notice status=\"error\" isDismissible={false}>\n\t\t\t\t\t\t\t\t{saveError}\n\t\t\t\t\t\t\t</Notice>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : null}\n\t\t\t\t\t{currentPath || code || messageContent ? (\n\t\t\t\t\t\tmessageContent ? (\n\t\t\t\t\t\t\t<div className={styles.messageArea}>\n\t\t\t\t\t\t\t\t{messageContent}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<CodeEditor\n\t\t\t\t\t\t\t\tref={editorRef}\n\t\t\t\t\t\t\t\tcode={code}\n\t\t\t\t\t\t\t\tonChange={setCode}\n\t\t\t\t\t\t\t\tcurrentPath={currentPath}\n\t\t\t\t\t\t\t\tclassName={styles.editor}\n\t\t\t\t\t\t\t\tonSaveShortcut={handleManualSave}\n\t\t\t\t\t\t\t\treadOnly={readOnly}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className={styles.placeholder}>\n\t\t\t\t\t\t\tSelect a file to view or edit its contents.\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Wraps a PlaygroundClient to satisfy AsyncWritableFilesystem interface\n * which requires EventTarget methods.\n */\nclass ClientFilesystemWrapper\n\textends EventTarget\n\timplements AsyncWritableFilesystem\n{\n\tprivate client: PlaygroundClient;\n\n\tconstructor(client: PlaygroundClient) {\n\t\tsuper();\n\t\tthis.client = client;\n\t}\n\tisDir(path: string) {\n\t\treturn this.client.isDir(path);\n\t}\n\tfileExists(path: string) {\n\t\treturn this.client.fileExists(path);\n\t}\n\tasync read(path: string): Promise<{ arrayBuffer(): Promise<ArrayBuffer> }> {\n\t\tconst buffer = await this.client.readFileAsBuffer(path);\n\t\treturn {\n\t\t\tarrayBuffer: async () => buffer.buffer,\n\t\t};\n\t}\n\treadFileAsText(path: string) {\n\t\treturn this.client.readFileAsText(path);\n\t}\n\tlistFiles(path: string) {\n\t\treturn this.client.listFiles(path);\n\t}\n\twriteFile(path: string, data: string | Uint8Array) {\n\t\treturn this.client.writeFile(path, data);\n\t}\n\tmkdir(path: string) {\n\t\treturn this.client.mkdir(path);\n\t}\n\trmdir(path: string, options?: { recursive?: boolean }) {\n\t\treturn this.client.rmdir(path, options);\n\t}\n\tmv(source: string, destination: string) {\n\t\treturn this.client.mv(source, destination);\n\t}\n\tunlink(path: string) {\n\t\treturn this.client.unlink(path);\n\t}\n}\n\nfunction useFilesystem(\n\tclient: PlaygroundClient | null\n): AsyncWritableFilesystem | null {\n\treturn useMemo(() => {\n\t\tif (!client) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new ClientFilesystemWrapper(client);\n\t}, [client]);\n}\n\nfunction getSaveStatusLabel(saveState: SaveState, saveError: string | null) {\n\tswitch (saveState) {\n\t\tcase SaveState.PENDING:\n\t\tcase SaveState.SAVING:\n\t\t\treturn 'Savingâ€¦';\n\t\tcase SaveState.SAVED:\n\t\t\treturn 'Saved';\n\t\tcase SaveState.ERROR:\n\t\t\treturn saveError ?? 'Save failed';\n\t\tdefault:\n\t\t\treturn '';\n\t}\n}\n\nfunction getSaveStatusClassName(\n\tsaveState: SaveState,\n\tstyleSheet: typeof styles\n) {\n\tswitch (saveState) {\n\t\tcase SaveState.PENDING:\n\t\t\treturn styleSheet.saveStatusPending;\n\t\tcase SaveState.SAVING:\n\t\t\treturn styleSheet.saveStatusSaving;\n\t\tcase SaveState.ERROR:\n\t\t\treturn styleSheet.saveStatusError;\n\t\tdefault:\n\t\t\treturn undefined;\n\t}\n}\n\nasync function flushPendingSave(\n\tclient: PlaygroundClient | null,\n\t{\n\t\tsaveTimeoutRef,\n\t\tcurrentPathRef,\n\t\tcodeRef,\n\t\tsetSaveState,\n\t\tsetSaveError,\n\t}: {\n\t\tsaveTimeoutRef: MutableRefObject<number | null>;\n\t\tcurrentPathRef: MutableRefObject<string | null>;\n\t\tcodeRef: MutableRefObject<string>;\n\t\tsetSaveState: React.Dispatch<React.SetStateAction<SaveState>>;\n\t\tsetSaveError: React.Dispatch<React.SetStateAction<string | null>>;\n\t}\n) {\n\tif (saveTimeoutRef.current === null) {\n\t\treturn;\n\t}\n\tif (!client || !currentPathRef.current) {\n\t\twindow.clearTimeout(saveTimeoutRef.current);\n\t\tsaveTimeoutRef.current = null;\n\t\treturn;\n\t}\n\twindow.clearTimeout(saveTimeoutRef.current);\n\tsaveTimeoutRef.current = null;\n\tsetSaveState(SaveState.SAVING);\n\ttry {\n\t\tawait client.writeFile(currentPathRef.current, codeRef.current);\n\t\tsetSaveState(SaveState.SAVED);\n\t\tsetSaveError(null);\n\t} catch (error) {\n\t\tlogger.error('Failed to save file', error);\n\t\tsetSaveState(SaveState.ERROR);\n\t\tsetSaveError('Could not save changes. Try again.');\n\t\tthrow error;\n\t}\n}\n"],"names":["MAX_INLINE_FILE_BYTES","seemsLikeBinary","buffer","len","i","createDownloadUrl","data","filename","blob","url","getMimeType","extension","mimeTypes","isPreviewableBinary","mimeType","FileExplorerSidebar","filesystem","currentPath","selectedDirPath","setSelectedDirPath","onFileOpened","onSelectionCleared","onShowMessage","documentRoot","treeRef","useRef","treeInitialPath","useMemo","normalizePath","dirname","lastSelectedPath","setLastSelectedPath","useState","handleOpenFile","path","shouldFocus","file","size","fname","jsxs","Fragment","jsx","downloadUrl","dataUrl","BinaryFilePreview","text","error","logger","styles","Icon","fileIcon","folderIcon","FilePickerTree","SAVE_DEBOUNCE_MS","SaveState","SiteFileBrowser","site","isVisible","client","usePlaygroundClient","useFilesystem","setCurrentPath","code","setCode","readOnly","setReadOnly","saveState","setSaveState","saveError","setSaveError","showExplorerOnMobile","setShowExplorerOnMobile","treeTypeAheadEnabled","setTreeTypeAheadEnabled","messageContent","setMessageContent","editorRef","saveTimeoutRef","skipNextSaveRef","codeRef","currentPathRef","clientRef","previousClientRef","hasAutoOpenedRef","cursorPositionsRef","useEffect","flushPendingSave","activeClient","timeout","previous","wpConfigPath","content","handleFileOpened","useCallback","currentPos","savedPos","interval","pos","finalPos","handleClearSelection","handleShowMessage","_path","message","handleManualSave","saveStatusLabel","getSaveStatusLabel","saveStatusClassName","getSaveStatusClassName","classNames","Button","Notice","CodeEditor","ClientFilesystemWrapper","options","source","destination","styleSheet"],"mappings":"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"}
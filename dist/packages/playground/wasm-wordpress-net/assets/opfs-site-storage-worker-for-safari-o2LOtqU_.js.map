{"version":3,"file":"opfs-site-storage-worker-for-safari-o2LOtqU_.js","sources":["../packages/playground/website/src/lib/state/opfs/opfs-site-storage-worker-for-safari.ts"],"sourcesContent":["/**\n * This worker module exists to allow writing file content to OPFS from the\n * main browser thread. Today (2024-08-17), Safari only appears to support\n * writing to OPFS via createSyncAccessHandle(), and that is only supported\n * within dedicated workers.\n *\n * This worker exists so non-worker threads can trigger writing to OPFS files.\n */\nonmessage = async function (event: MessageEvent) {\n\tconst filePath: string = event.data.path;\n\tconst content: string = event.data.content;\n\tconst responsePort = event.ports[0];\n\n\tconst pathParts = filePath.split('/').filter((p) => p.length > 0);\n\n\tconst fileName = pathParts.pop();\n\tif (fileName === undefined) {\n\t\tthrow new Error(`Invalid path: '${filePath}'`);\n\t}\n\n\tlet parentDirHandle = await navigator.storage.getDirectory();\n\tfor (const part of pathParts) {\n\t\tparentDirHandle = await parentDirHandle.getDirectoryHandle(part);\n\t}\n\n\tconst fileHandle = await parentDirHandle.getFileHandle(fileName, {\n\t\tcreate: true,\n\t});\n\n\tconst syncAccessHandle = await fileHandle.createSyncAccessHandle();\n\ttry {\n\t\tconst encodedContent = new TextEncoder().encode(content);\n\t\tsyncAccessHandle.truncate(0);\n\t\tsyncAccessHandle.write(encodedContent);\n\t\tresponsePort.postMessage('done');\n\t} finally {\n\t\tsyncAccessHandle.close();\n\t}\n};\n"],"names":["event","filePath","content","responsePort","pathParts","p","fileName","parentDirHandle","part","syncAccessHandle","encodedContent"],"mappings":"yBAQA,UAAY,eAAgBA,EAAqB,CAChD,MAAMC,EAAmBD,EAAM,KAAK,KAC9BE,EAAkBF,EAAM,KAAK,QAC7BG,EAAeH,EAAM,MAAM,CAAC,EAE5BI,EAAYH,EAAS,MAAM,GAAG,EAAE,OAAQI,GAAMA,EAAE,OAAS,CAAC,EAE1DC,EAAWF,EAAU,IAAA,EAC3B,GAAIE,IAAa,OAChB,MAAM,IAAI,MAAM,kBAAkBL,CAAQ,GAAG,EAG9C,IAAIM,EAAkB,MAAM,UAAU,QAAQ,aAAA,EAC9C,UAAWC,KAAQJ,EAClBG,EAAkB,MAAMA,EAAgB,mBAAmBC,CAAI,EAOhE,MAAMC,EAAmB,MAJN,MAAMF,EAAgB,cAAcD,EAAU,CAChE,OAAQ,EAAA,CACR,GAEyC,uBAAA,EAC1C,GAAI,CACH,MAAMI,EAAiB,IAAI,cAAc,OAAOR,CAAO,EACvDO,EAAiB,SAAS,CAAC,EAC3BA,EAAiB,MAAMC,CAAc,EACrCP,EAAa,YAAY,MAAM,CAChC,QAAA,CACCM,EAAiB,MAAA,CAClB,CACD"}